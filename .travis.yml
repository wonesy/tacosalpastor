language: python
python:
    - "3.6"
install:
    - pip install -r requirements.txt
services:
    - mysql
dist: trusty
sudo: required
#addons:
#    apt:
#        packages:
#            - mysql-server
#            - mysql-client
#            - libmysqlclient-dev
before_install:
    - sudo apt-get update --option Acquire::Retries=100 --option Acquire::http::Timeout="60"
    - sudo apt-get purge mysql-client-core*
    - sudo apt-get autoremove
    - sudo apt-get autoclean
    - sudo apt-get install mysql-client-core-5.7
    - sudo apt-get install mysql-server
before_script:
    - export MYSQL_DATABASE=alpastor
    - export MYSQL_USERNAME=alpastoradmin
    - export MYSQL_USER_PASS=alpastorpass
    - mysql -u root -e 'CREATE DATABASE IF NOT EXISTS alpastor;'
    - mysql -u root -e "CREATE USER 'alpastoradmin'@'localhost' IDENTIFIED BY 'alpastorpass';"
    - mysql -u root -e "GRANT ALL ON alpastor.* TO 'alpastor'@'localhost';"

